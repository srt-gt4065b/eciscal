<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 ECIS Academic Calendar</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#264653">
    <meta name="apple-mobile-web-app-title" content="ECIS Cal">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Noto+Sans+SC:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-cream: #FAF9F6;
            --deep-teal: #264653;
            --text-dark: #2c3e50;
            --card-shadow: 5px 5px 0px rgba(38, 70, 83, 0.15);
            /* Department Colors */
            --col-common: #8BC34A; --col-aim: #9B59B6; --col-aib: #3498DB;
            --col-gh: #F1C40F; --col-id: #E67E22;
            --col-holiday: #E74C3C; --col-academic: #2A9D8F;
        }

        body {
            font-family: 'Open Sans', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-cream);
            color: var(--text-dark);
            margin: 0; padding: 0;
            /* iOS Safe Area handling */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(231, 111, 81, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(42, 157, 143, 0.05) 0%, transparent 20%);
            background-attachment: fixed;
            -webkit-tap-highlight-color: transparent;
        }

        header {
            background-color: var(--deep-teal); color: white;
            padding: 60px 20px 40px; text-align: center; position: relative;
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
        }

        .lang-switcher {
            position: absolute; top: 20px; right: 20px;
            display: flex; gap: 8px; z-index: 50;
        }
        .lang-btn {
            background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5);
            color: white; padding: 6px 10px; border-radius: 15px;
            cursor: pointer; font-weight: bold; font-family: 'Montserrat'; font-size: 0.75em;
        }
        .lang-btn.active { background: var(--col-gh); color: #333; border-color: var(--col-gh); }

        h1 {
            font-family: 'Montserrat', sans-serif; font-weight: 900;
            font-size: 1.8em; margin: 0; text-transform: uppercase;
            position: relative; display: inline-block; line-height: 1.2;
        }
        p { margin-top: 15px; font-size: 1em; opacity: 0.9; }

        .container {
            max-width: 800px; margin: -30px auto 100px;
            padding: 0 15px; position: relative; z-index: 10;
        }

        .controls { text-align: center; margin-bottom: 30px; display: flex; justify-content: center; gap: 10px; }
        select {
            padding: 10px 20px; border-radius: 30px;
            border: 3px solid var(--deep-teal); font-size: 16px;
            font-weight: 700; color: var(--deep-teal); background: white;
        }

        /* Install Button (Hidden by default) */
        #installBtn {
            display: none; padding: 10px 20px; border-radius: 30px;
            background: var(--col-id); color: white; border: none;
            font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            animation: pulse 2s infinite; cursor: pointer;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .calendar-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
            gap: 20px; align-items: start;
        }
        @media(min-width: 600px) { .calendar-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); } }

        .event-card {
            background: white; border: 2px solid var(--deep-teal);
            padding: 20px; position: relative; border-radius: 15px;
            box-shadow: var(--card-shadow); transition: transform 0.2s;
        }
        .event-card:active { transform: scale(0.98); }

        /* Department Colors */
        .event-card.dept-common { border-left: 8px solid var(--col-common); }
        .event-card.dept-aim { border-left: 8px solid var(--col-aim); }
        .event-card.dept-aib { border-left: 8px solid var(--col-aib); }
        .event-card.dept-gh { border-left: 8px solid var(--col-gh); }
        .event-card.dept-id { border-left: 8px solid var(--col-id); }

        .user-badge {
            position: absolute; top: 15px; right: 15px;
            background: #333; color: white; font-size: 0.7em;
            padding: 3px 8px; border-radius: 10px; font-weight: bold;
        }

        .event-month { font-weight: 900; color: #aaa; font-size: 0.8em; margin-bottom: 5px; }
        .event-date {
            font-family: 'Montserrat'; font-size: 1.4em; font-weight: 900;
            margin-bottom: 10px; color: var(--deep-teal);
        }
        .tag {
            display: inline-block; padding: 5px 10px; border-radius: 15px;
            font-size: 0.7em; font-weight: 700; color: white; margin-top: 10px;
        }
        .tag.dept-common { background: var(--col-common); }
        .tag.dept-aim { background: var(--col-aim); }
        .tag.dept-aib { background: var(--col-aib); }
        .tag.dept-gh { background: var(--col-gh); color: #333; }
        .tag.dept-id { background: var(--col-id); }
        .tag.holiday { background: var(--col-holiday); }
        .tag.academic { background: var(--col-academic); }
        .tag.event { background: var(--deep-teal); }

        /* FAB */
        .fab {
            position: fixed; bottom: 30px; right: 20px;
            width: 60px; height: 60px;
            background-color: var(--deep-teal); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 28px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 100;
            border: 2px solid white; cursor: pointer;
        }

        /* Modal */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 200; backdrop-filter: blur(3px);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background: #fff; padding: 30px 20px; width: 85%; max-width: 400px;
            border-radius: 20px; border: 3px solid var(--deep-teal);
        }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
        .form-group input, .form-group select {
            width: 100%; padding: 10px; border: 2px solid #ddd;
            border-radius: 10px; box-sizing: border-box; font-size: 16px;
        }
        .btn-group { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .btn { padding: 10px 20px; border-radius: 20px; border: none; font-weight: bold; }
        .btn-save { background: var(--deep-teal); color: white; }
        .btn-cancel { background: #eee; }
    </style>
</head>
<body>

<script>
    // 1. Create Dynamic Icon (Emoji)
    const iconCanvas = document.createElement('canvas');
    iconCanvas.width = 512; iconCanvas.height = 512;
    const ctx = iconCanvas.getContext('2d');
    ctx.fillStyle = '#264653'; ctx.fillRect(0,0,512,512); // Background
    ctx.font = '300px serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText('üé®', 256, 270); // Emoji
    const iconUrl = iconCanvas.toDataURL('image/png');

    // 2. Inject Link Tags
    const linkIcon = document.createElement('link');
    linkIcon.rel = 'apple-touch-icon'; linkIcon.href = iconUrl;
    document.head.appendChild(linkIcon);
    const linkFav = document.createElement('link');
    linkFav.rel = 'icon'; linkFav.href = iconUrl;
    document.head.appendChild(linkFav);

    // 3. Create Dynamic Manifest
    const manifest = {
        "name": "ECIS Calendar",
        "short_name": "ECIS Cal",
        "start_url": ".",
        "display": "standalone",
        "background_color": "#FAF9F6",
        "theme_color": "#264653",
        "orientation": "portrait",
        "icons": [{ "src": iconUrl, "sizes": "512x512", "type": "image/png" }]
    };
    const stringManifest = JSON.stringify(manifest);
    const blob = new Blob([stringManifest], {type: 'application/json'});
    const manifestURL = URL.createObjectURL(blob);
    const linkManifest = document.createElement('link');
    linkManifest.rel = 'manifest'; linkManifest.href = manifestURL;
    document.head.appendChild(linkManifest);
</script>

<header>
    <div class="lang-switcher">
        <button class="lang-btn active" onclick="setLanguage('ko')">KO</button>
        <button class="lang-btn" onclick="setLanguage('en')">EN</button>
        <button class="lang-btn" onclick="setLanguage('zh')">ZH</button>
    </div>
    <h1 id="ui-title">2026 ECIS Academic Calendar</h1>
    <p id="ui-subtitle">Woosong University</p>
</header>

<div class="container">
    <div class="controls">
        <button id="installBtn" onclick="installApp()">üì≤ Install App</button>
        <select id="monthFilter" onchange="renderCalendar()"></select>
    </div>

    <div id="calendarGrid" class="calendar-grid">
        <p style="text-align:center;">Loading...</p>
    </div>
</div>

<div class="fab" onclick="openModal()">+</div>

<div class="modal-overlay" id="eventModal">
    <div class="modal-content">
        <h2 id="modal-title">‚úèÔ∏è Add Event</h2>
        <div class="form-group">
            <label id="label-title">Title</label>
            <input type="text" id="inputTitle">
        </div>
        <div class="form-group">
            <label id="label-start">Start Date</label>
            <input type="date" id="inputStart">
        </div>
        <div class="form-group">
            <label id="label-end">End Date</label>
            <input type="date" id="inputEnd">
        </div>
        <div class="form-group">
            <label id="label-cat">Dept / Category</label>
            <select id="inputType">
                <option value="dept-common">üü¢ Common</option>
                <option value="dept-aim">üü£ AI Mgmt</option>
                <option value="dept-aib">üîµ AI BigData</option>
                <option value="dept-gh">üü° Global Hosp</option>
                <option value="dept-id">üü† Interdisciplinary</option>
            </select>
        </div>
        <div class="btn-group">
            <button class="btn btn-cancel" onclick="closeModal()" id="btn-cancel">Cancel</button>
            <button class="btn btn-save" onclick="saveEvent()" id="btn-save">Save</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

    // üî¥ [YOUR FIREBASE CONFIG HERE] - Ïã§Ï†ú ÌÇ§Í∞íÏúºÎ°ú ÍµêÏ≤¥ ÌïÑÏàò!
    const firebaseConfig = {
        apiKey: "AIzaSyAdkdWL2ab0f_fiYvmS0Q_btAQP76-IufM",
  authDomain: "ecis-calendar-c83bb.firebaseapp.com",
  databaseURL: "https://ecis-calendar-c83bb-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "ecis-calendar-c83bb",
  storageBucket: "ecis-calendar-c83bb.firebasestorage.app",
  messagingSenderId: "412332086060",
  appId: "1:412332086060:web:fc3c0aeec7d298ffb5d289",
  measurementId: "G-VEZ16FP32S"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Multilingual Data
    let currentLang = 'ko';
    const i18n = {
        ko: {
            title: "2026 ECIS ÌïôÏÇ¨ ÏùºÏ†ï", subtitle: "Ïö∞ÏÜ°ÎåÄÌïôÍµê Endicott College",
            allMonths: "Ï†ÑÏ≤¥ Î≥¥Í∏∞", empty: "ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§.",
            modalTitle: "ÏùºÏ†ï Ï∂îÍ∞Ä", lblTitle: "Ï†úÎ™©", lblStart: "ÏãúÏûëÏùº", lblEnd: "Ï¢ÖÎ£åÏùº", lblCat: "Íµ¨Î∂Ñ",
            btnCancel: "Ï∑®ÏÜå", btnSave: "Ï†ÄÏû•", install: "üì≤ Ïï± ÏÑ§ÏπòÌïòÍ∏∞",
            cats: { "dept-common":"üü¢ Í≥µÌÜµ", "dept-aim":"üü£ AIÍ≤ΩÏòÅ", "dept-aib":"üîµ AIÎπÖÎç∞Ïù¥ÌÑ∞", "dept-gh":"üü° Í∏ÄÎ°úÎ≤åÌò∏Ïä§Ìîº", "dept-id":"üü† ÏûêÏú†Ï†ÑÍ≥µ", holiday:"üî¥ Í≥µÌú¥Ïùº", academic:"üîµ ÌïôÏÇ¨", event:"üü° ÌñâÏÇ¨" },
            months: ["1Ïõî","2Ïõî","3Ïõî","4Ïõî","5Ïõî","6Ïõî","7Ïõî","8Ïõî","9Ïõî","10Ïõî","11Ïõî","12Ïõî"]
        },
        en: {
            title: "2026 ECIS Calendar", subtitle: "Woosong Univ. Endicott College",
            allMonths: "View All", empty: "No events.",
            modalTitle: "Add Event", lblTitle: "Title", lblStart: "Start", lblEnd: "End", lblCat: "Dept",
            btnCancel: "Cancel", btnSave: "Save", install: "üì≤ Install App",
            cats: { "dept-common":"üü¢ Common", "dept-aim":"üü£ AI Mgmt", "dept-aib":"üîµ AI BigData", "dept-gh":"üü° Global Hosp", "dept-id":"üü† Interdisciplinary", holiday:"üî¥ Holiday", academic:"üîµ Academic", event:"üü° Event" },
            months: ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
        },
        zh: {
            title: "2026 ECIS Ê†°ÂéÜ", subtitle: "ÂèàÊùæÂ§ßÂ≠¶ Endicott Â≠¶Èô¢",
            allMonths: "Êü•ÁúãÂÖ®ÈÉ®", empty: "Êó†Êó•Á®ã",
            modalTitle: "Ê∑ªÂä†Êó•Á®ã", lblTitle: "Ê†áÈ¢ò", lblStart: "ÂºÄÂßã", lblEnd: "ÁªìÊùü", lblCat: "ÂàÜÁ±ª",
            btnCancel: "ÂèñÊ∂à", btnSave: "‰øùÂ≠ò", install: "üì≤ ÂÆâË£ÖÂ∫îÁî®",
            cats: { "dept-common":"üü¢ ÂÖ¨ÂÖ±", "dept-aim":"üü£ AIÁªèËê•", "dept-aib":"üîµ AIÂ§ßÊï∞ÊçÆ", "dept-gh":"üü° ÂÖ®ÁêÉÈÖíÂ∫ó", "dept-id":"üü† Ëá™Áî±‰∏ì‰∏ö", holiday:"üî¥ ÂÖ¨‰ºë", academic:"üîµ Â≠¶‰∫ã", event:"üü° Ê¥ªÂä®" },
            months: ["1Êúà","2Êúà","3Êúà","4Êúà","5Êúà","6Êúà","7Êúà","8Êúà","9Êúà","10Êúà","11Êúà","12Êúà"]
        }
    };

    const staticEvents = [
        { month: 1, date: "2026-01-01", type: "holiday", title: { ko: "ÏÉàÌï¥", en: "New Year", zh: "ÂÖÉÊó¶" } },
        { month: 2, date: "2026-02-27", type: "event", title: { ko: "ÏûÖÌïôÏãù", en: "Matriculation", zh: "ÂÖ•Â≠¶ÂÖ∏Á§º" } },
        { month: 3, date: "2026-03-02", type: "academic", title: { ko: "Í∞úÍ∞ï", en: "Spring Begins", zh: "ÂºÄÂ≠¶" } }
        // ÌïÑÏöî Ïãú Îçî Ï∂îÍ∞Ä
    ];

    let allEvents = [];
    const eventsRef = ref(db, 'events');
    onValue(eventsRef, (snap) => {
        const data = snap.val();
        const userEvents = data ? Object.values(data) : [];
        allEvents = [...staticEvents, ...userEvents].sort((a,b)=>a.date.localeCompare(b.date));
        renderUI();
    });

    window.setLanguage = (lang) => {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`.lang-btn[onclick="setLanguage('${lang}')"]`).classList.add('active');
        renderUI();
    };

    window.renderUI = () => {
        const t = i18n[currentLang];
        document.getElementById('ui-title').innerText = t.title;
        document.getElementById('ui-subtitle').innerText = t.subtitle;
        document.getElementById('installBtn').innerText = t.install;
        document.getElementById('modal-title').innerText = t.modalTitle;
        document.getElementById('label-title').innerText = t.lblTitle;
        document.getElementById('label-start').innerText = t.lblStart;
        document.getElementById('label-end').innerText = t.lblEnd;
        document.getElementById('label-cat').innerText = t.lblCat;
        document.getElementById('btn-cancel').innerText = t.btnCancel;
        document.getElementById('btn-save').innerText = t.btnSave;

        const opts = document.getElementById('inputType').options;
        for(let i=0; i<opts.length; i++) opts[i].text = t.cats[opts[i].value] || opts[i].value;

        const filter = document.getElementById('monthFilter');
        const curr = filter.value || 'all';
        filter.innerHTML = `<option value="all">${t.allMonths}</option>`;
        t.months.forEach((m,i) => filter.innerHTML += `<option value="${i+1}">${m}</option>`);
        filter.value = curr;
        renderCalendar();
    };

    window.renderCalendar = () => {
        const grid = document.getElementById('calendarGrid');
        const fVal = document.getElementById('monthFilter').value;
        const t = i18n[currentLang];
        grid.innerHTML = '';
        const filtered = allEvents.filter(e => fVal === 'all' || e.month == fVal);

        if(filtered.length === 0) { grid.innerHTML = `<p style="text-align:center;width:100%;padding:30px;">${t.empty}</p>`; return; }

        filtered.forEach((ev, idx) => {
            let title = typeof ev.title === 'object' ? (ev.title[currentLang] || ev.title.ko) : ev.title;
            const isUser = ev.source === 'user';
            const card = document.createElement('div');
            card.className = `event-card ${ev.type}`;
            card.style.animation = `fadeIn 0.5s forwards ${idx*0.05}s`;
            card.innerHTML = `
                ${isUser ? '<div class="user-badge">Dept</div>' : ''}
                <div class="event-month">${ev.month} / ${t.months[ev.month-1]}</div>
                <div class="event-date">${ev.date}</div>
                <div class="event-title">${title}</div>
                <span class="tag ${ev.type}">${t.cats[ev.type] || ev.type}</span>
            `;
            grid.appendChild(card);
        });
    };

    window.saveEvent = () => {
        const title = document.getElementById('inputTitle').value;
        const start = document.getElementById('inputStart').value;
        const end = document.getElementById('inputEnd').value;
        const type = document.getElementById('inputType').value;
        if(!title || !start) return;
        const dateStr = (end && end !== start) ? `${start} ~ ${end}` : start;
        const month = new Date(start).getMonth() + 1;
        push(eventsRef, { title, date: dateStr, month, type, source: 'user', createdAt: Date.now() })
            .then(() => { closeModal(); document.getElementById('inputTitle').value=''; document.getElementById('inputStart').value=''; });
    };

    renderUI();
</script>

<script>
    // --- Install Logic ---
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault(); deferredPrompt = e;
        document.getElementById('installBtn').style.display = 'block';
    });
    async function installApp() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            deferredPrompt = null;
            document.getElementById('installBtn').style.display = 'none';
        } else {
            // For iOS or Desktop where prompt is not supported
            alert("ÏïÑÏù¥Ìè∞(iOS): ÏÇ¨ÌååÎ¶¨ ÌïòÎã® 'Í≥µÏú†' Î≤ÑÌäº -> 'Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä'\nÏïàÎìúÎ°úÏù¥Îìú: Î∏åÎùºÏö∞Ï†Ä Î©îÎâ¥ -> 'Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä'Î•º ÎàåÎü¨Ï£ºÏÑ∏Ïöî.");
        }
    }

    function openModal() { document.getElementById('eventModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('eventModal').style.display = 'none'; }
    window.onclick = function(e) { if(e.target == document.getElementById('eventModal')) closeModal(); }
    
    const sheet = document.styleSheets[0];
    sheet.insertRule(`@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }`, sheet.cssRules.length);
</script>

</body>
</html>
